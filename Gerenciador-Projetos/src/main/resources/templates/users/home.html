<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Gerenciador de Projetos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
          crossorigin="anonymous">
    <style>
        body { padding-top: 50px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="welcome-message" th:data-userid="${userId}">Carregando...</h1>

    <p><a href="/web/users">Gerenciar Usuários</a></p>
    <p><a href="/web/teams">Gerenciar Equipes</a></p>
     <p><a href="/">Sair (Voltar para Login)</a></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

<script>
    const welcomeMessageElement = document.getElementById('welcome-message');
    const userId = welcomeMessageElement.getAttribute('data-userid');
    
    async function fetchUserDetails() {
        if (!userId || isNaN(userId)) {
            welcomeMessageElement.textContent = 'Erro: ID de usuário inválido.';
            welcomeMessageElement.classList.add('text-danger');
            return;
        }

        try {
            const apiUrl = `/api/users/${userId}`;
            const response = await fetch(apiUrl);

            if (response.status === 404) {
                 welcomeMessageElement.textContent = 'Usuário não encontrado.';
                 welcomeMessageElement.classList.add('text-warning');
                 return;
            }
            if (!response.ok) {
                throw new Error(`Erro na API: ${response.statusText}`);
            }

            const userData = await response.json();
            console.log(userData)

            if (userData && userData.name) {
                welcomeMessageElement.textContent = `Bem Vindo, ${userData.name}!`;
                welcomeMessageElement.classList.remove('text-danger', 'text-warning');
            } else {
                welcomeMessageElement.textContent = 'Bem Vindo!';
            }

        } catch (error) {
            console.error('Erro ao buscar detalhes do usuário:', error);
            welcomeMessageElement.textContent = 'Erro ao carregar dados do usuário.';
            welcomeMessageElement.classList.add('text-danger');
        }
    }

    document.addEventListener('DOMContentLoaded', fetchUserDetails);
</script>

</body>
</html>