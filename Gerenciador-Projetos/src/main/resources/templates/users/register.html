<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Usuário</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
          crossorigin="anonymous">
    <style>
        body { padding-top: 20px; }
        .form-container { max-width: 600px; margin: auto; }
    </style>
</head>
<body>

<div class="container form-container">
    <h1 class="mb-4">Cadastrar Novo Usuário</h1>

    <div id="alert-placeholder"></div>

    <form id="register-form">
        <div class="mb-3">
            <label for="name" class="form-label">Nome Completo *</label>
            <input type="text" class="form-control" id="name" required>
        </div>
        <div class="mb-3">
            <label for="email" class="form-label">Email *</label>
            <input type="email" class="form-control" id="email" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Senha *</label>
            <input type="password" class="form-control" id="password" required>
        </div>
        <div class="mb-3">
            <label for="position" class="form-label">Cargo</label>
            <input type="text" class="form-control" id="position">
        </div>
        
        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-primary">Cadastrar</button>
            <a href="/" class="btn btn-secondary">Voltar para Login</a>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

<script>
    const form = document.getElementById('register-form');
    const alertPlaceholder = document.getElementById('alert-placeholder');

    function showAlert(message, type = 'danger') {
        const wrapper = document.createElement('div');
        wrapper.innerHTML = [
            `<div class="alert alert-${type} alert-dismissible" role="alert">`,
            `   <div>${message}</div>`,
            '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
            '</div>'
        ].join('');
        alertPlaceholder.innerHTML = '';
        alertPlaceholder.append(wrapper);
    }

    form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const position = document.getElementById('position').value;

        const userData = {
            name: name,
            email: email,
            password: password,
            position: position
        };

        try {
            const response = await fetch('/api/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });

            if (response.status === 201) {
                showAlert('Usuário cadastrado com sucesso! Redirecionando para login...', 'success');
                form.reset();
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);

            } else {
                const errorMessage = await response.text();
                showAlert(errorMessage || 'Erro ao cadastrar usuário.');
            }

        } catch (error) {
            console.error('Erro na requisição:', error);
            showAlert('Erro de conexão. Tente novamente.');
        }
    });
</script>

</body>
</html>